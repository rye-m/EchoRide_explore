<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Text-to-Speech App</title>
    <link
      href="https://fonts.googleapis.com/css?family=Gloria+Hallelujah&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>

  <body>
    <main>
      <wired-card elevation="5">
        <h1>üé§ Text-to-Speech</h1>
        <p>Type your message and click play to hear it spoken!</p>
      </wired-card>
      
      <section>
        <wired-input 
          id="textInput" 
          placeholder="Type your message here..."
          rows="4"
          maxlength="500">
        </wired-input>
        
        <wired-button id="playButton" elevation="2">
          ‚ñ∂Ô∏è Play
        </wired-button>
        
        <div id="status"></div>
      </section>
    </main>
  </body>

  <script type="module" src="https://unpkg.com/wired-elements?module"></script>
  <script type="module">
    class TextToSpeechApp {
      constructor() {
        this.textInput = document.getElementById('textInput');
        this.playButton = document.getElementById('playButton');
        this.status = document.getElementById('status');
        this.isSpeaking = false;
        this.currentUtterance = null;
        
        this.init();
      }
      
      init() {
        this.playButton.addEventListener('click', () => this.toggleSpeech());
        
        // Listen for Enter key (Ctrl+Enter since it's a textarea)
        this.textInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' && e.ctrlKey) {
            e.preventDefault();
            this.toggleSpeech();
          }
        });
        
        this.showStatus('Ready to speak! Type your message above.');
      }
      
      toggleSpeech() {
        if (this.isSpeaking) {
          this.stopSpeech();
        } else {
          this.startSpeech();
        }
      }
      
      startSpeech() {
        const text = this.textInput.value.trim();
        
        if (!text) {
          this.showStatus('Please enter some text to speak');
          return;
        }
        
        if (!('speechSynthesis' in window)) {
          this.showStatus('Text-to-speech not supported in this browser');
          return;
        }
        
        // Create utterance
        this.currentUtterance = new SpeechSynthesisUtterance(text);
        
        // Set up event handlers
        this.currentUtterance.onstart = () => {
          this.isSpeaking = true;
          this.updateButton();
          this.showStatus('üîä Speaking...');
        };
        
        this.currentUtterance.onend = () => {
          this.isSpeaking = false;
          this.currentUtterance = null;
          this.updateButton();
          this.showStatus('‚úÖ Finished speaking!');
          setTimeout(() => this.showStatus('Ready to speak!'), 2000);
        };
        
        this.currentUtterance.onerror = (event) => {
          this.isSpeaking = false;
          this.currentUtterance = null;
          this.updateButton();
          this.showStatus('‚ùå Error occurred while speaking');
          console.error('Speech synthesis error:', event);
        };
        
        // Start speaking
        speechSynthesis.speak(this.currentUtterance);
      }
      
      stopSpeech() {
        if (speechSynthesis.speaking) {
          speechSynthesis.cancel();
        }
        
        this.isSpeaking = false;
        this.currentUtterance = null;
        this.updateButton();
        this.showStatus('‚èπÔ∏è Speech stopped');
        setTimeout(() => this.showStatus('Ready to speak!'), 2000);
      }
      
      updateButton() {
        if (this.isSpeaking) {
          this.playButton.textContent = '‚èπÔ∏è Stop';
        } else {
          this.playButton.textContent = '‚ñ∂Ô∏è Play';
        }
      }
      
      showStatus(message) {
        this.status.textContent = message;
      }
    }
    
    // Initialize the app
    new TextToSpeechApp();
  </script>
</html>